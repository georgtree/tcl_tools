<!DOCTYPE html><html><head><meta charset="utf-8"/>
<title>Collection of Tcl tools</title>
<link rel='stylesheet' type='text/css' href='assets/ruff-min.css' />
<script type='text/javascript' src='assets/ruff-min.js'></script>
</head>
<body>
<div class='ruff-layout'>
<header class='ruff-layout-header ruff-hd'>
<a style='text-decoration:none;' href='index.html'>Collection of Tcl tools (v0.1)</a>


            <div id="ruffButtonBar">
            <button id="ruffNavMove" onclick="ruffMoveNavPane()"></button>
            <button id="ruffToggleTheme" onclick="ruffNextTheme()"></button>
            </div>
        </header><main class='ruff-layout-main ruff-bd'><h1 class='ruff'><a name='::mathutil'></a>::mathutil<span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h1>
<div style='clear:both;'></div>
<h2 class='ruff'><a name='::mathutil-Commands'></a>Commands<span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h2>
<div style='clear:both;'></div>
<h3 class='ruffproc'><a name='::mathutil::cumtrapz'>cumtrapz</a><span class='ns_scope'> [<a href="index-mathutil.html#::mathutil" title="::mathutil" class='ruff_cmd'>::mathutil</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<p class='ruff'>Does trapezoidal integration with storing cumulative data at each point</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>cumtrapz</span> <span class='ruff_arg'>x y ?init?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code>x</code></td><td>List of x values.</td></tr>
<tr><td><code>y</code></td><td>List of y values.</td></tr>
<tr><td><code>init</code></td><td>Start value. Optional, default <code>0</code>.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list each value of which is the value of integral across all previous xy values</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_mathutil_cumtrapz' href="javascript:toggleSource('mathutil_cumtrapz')">Show source</a></p>
<div id='mathutil_cumtrapz' class='ruff_dyn_src'><pre>proc ::mathutil::cumtrapz {x y {init 0}} {

    # Does trapezoidal integration with storing cumulative data at each point
    #  x - list of x values
    #  y - list of y values
    #  init - start value
    # Returns: list each value of which is the value of integral across all previous xy values
    set xLen [llength $x]
    set yLen [llength $y]
    if {$xLen != $yLen} {
        error &quot;Length of x '$xLen' is not equal to length of y '$yLen'&quot;
    }
    set result $init
    for {set i 0} {$i&lt;[- $xLen 1]} {incr i} {
        set result [= {$result+([@ $y [+ $i 1]]+[@ $y $i])/2.0*([@ $x [+ $i 1]]-[@ $x $i])}]
        lappend resultList $result
    }
    return $resultList
}</pre></div>
</div><h3 class='ruffproc'><a name='::mathutil::deriv1'>deriv1</a><span class='ns_scope'> [<a href="index-mathutil.html#::mathutil" title="::mathutil" class='ruff_cmd'>::mathutil</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<p class='ruff'>Calculates first derivative of x-y lists</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>deriv1</span> <span class='ruff_arg'>x y</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code>x</code></td><td>List of x values.</td></tr>
<tr><td><code>y</code></td><td>List of y values.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>For calculating derivative we use 3-point method with unequal steps, equations were taken from &quot;Finite Difference Formulae for Unequal Sub-Intervals Using Lagrange's Interpolation Formula&quot;, January 2009, International Journal of Mathematical Analysis 3(17):815-827, Ashok Kumar Singh</p>
<h5 class='ruff'>Return value</h5><p class='ruff'>value of first derivative</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_mathutil_deriv1' href="javascript:toggleSource('mathutil_deriv1')">Show source</a></p>
<div id='mathutil_deriv1' class='ruff_dyn_src'><pre>proc ::mathutil::deriv1 {x y} {

    # Calculates first derivative of x-y lists
    #  x - list of x values
    #  y - list of y values
    # Returns: value of first derivative
    #
    # For calculating derivative we use 3-point method with unequal steps, equations
    # were taken from &quot;Finite Difference Formulae for Unequal Sub-Intervals Using Lagrange's Interpolation Formula&quot;,
    # January 2009, International Journal of Mathematical Analysis 3(17):815-827, Ashok Kumar Singh
    set xLen [llength $x]
    set yLen [llength $y]
    if {$xLen != $yLen} {
        error &quot;Length of x '$xLen' is not equal to length of y '$yLen'&quot;
    }
    set numPoints $xLen
    # calculate first point
    set h1 [- [@ $x 1] [@ $x 0]]
    set h2 [- [@ $x 2] [@ $x 1]]
    lappend yDeriv [= {-(2*$h1+$h2)/($h1*($h1+$h2))*[@ $y 0]+($h1+$h2)/($h1*$h2)*[@ $y 1]- $h1/($h2*($h1+$h2))*[@ $y 2]}]
    # calculate inner points
    for {set i 1} {$i&lt;[- $numPoints 1]} {incr i} {
        set h1 [- [@ $x $i] [@ $x [- $i 1]]]
        set h2 [- [@ $x [+ $i 1]] [@ $x $i]]
        lappend yDeriv [= {-$h2/($h1*($h1+$h2))*[@ $y [- $i 1]]-($h1-$h2)/($h1*$h2)*[@ $y $i]+ $h1/($h2*($h1+$h2))*[@ $y [+ $i 1]]}]
    }
    # calculate last point
    set h1 [- [@ $x end-1] [@ $x end-2]]
    set h2 [- [@ $x end] [@ $x end-1]]
    lappend yDeriv [= {$h2/($h1*($h1+$h2))*[@ $y end-2]-($h1+$h2)/($h1*$h2)*[@ $y end-1]+ ($h1+2*$h2)/($h2*($h1+$h2))*[@ $y end]}]
    return $yDeriv
}</pre></div>
</div><h3 class='ruffproc'><a name='::mathutil::deriv2'>deriv2</a><span class='ns_scope'> [<a href="index-mathutil.html#::mathutil" title="::mathutil" class='ruff_cmd'>::mathutil</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<p class='ruff'>Calculates second derivative of x-y lists</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>deriv2</span> <span class='ruff_arg'>x y</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code>x</code></td><td>List of x values.</td></tr>
<tr><td><code>y</code></td><td>List of y values.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>For calculating derivative we use 3-point method with unequal steps, equations were taken from &quot;Finite Difference Formulae for Unequal Sub-Intervals Using Lagrange's Interpolation Formula&quot;, January 2009, International Journal of Mathematical Analysis 3(17):815-827, Ashok Kumar Singh</p>
<h5 class='ruff'>Return value</h5><p class='ruff'>value of second derivative</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_mathutil_deriv2' href="javascript:toggleSource('mathutil_deriv2')">Show source</a></p>
<div id='mathutil_deriv2' class='ruff_dyn_src'><pre>proc ::mathutil::deriv2 {x y} {

    # Calculates second derivative of x-y lists
    #  x - list of x values
    #  y - list of y values
    # Returns: value of second derivative
    #
    # For calculating derivative we use 3-point method with unequal steps, equations
    # were taken from &quot;Finite Difference Formulae for Unequal Sub-Intervals Using Lagrange's Interpolation Formula&quot;,
    # January 2009, International Journal of Mathematical Analysis 3(17):815-827, Ashok Kumar Singh
    set xLen [llength $x]
    set yLen [llength $y]
    if {$xLen != $yLen} {
        error &quot;Length of x '$xLen' is not equal to length of y '$yLen'&quot;
    }
    set numPoints $xLen
    # calculate first point
    set h1 [- [@ $x 1] [@ $x 0]]
    set h2 [- [@ $x 2] [@ $x 1]]
    lappend yDeriv [= {2*($h2*[@ $y 0]-($h1+$h2)*[@ $y 1]+$h1*[@ $y 2])/($h1*$h2*($h1+$h2))}]
    # calculate inner points
    for {set i 1} {$i&lt;[- $numPoints 1]} {incr i} {
        set h1 [- [@ $x $i] [@ $x [- $i 1]]]
        set h2 [- [@ $x [+ $i 1]] [@ $x $i]]
        lappend yDeriv [= {2*($h2*[@ $y [- $i 1]]-($h1+$h2)*[@ $y $i]+$h1*[@ $y [+ $i 1]])/($h1*$h2*($h1+$h2))}]
    }
    # calculate last point
    set h1 [- [@ $x end-1] [@ $x end-2]]
    set h2 [- [@ $x end] [@ $x end-1]]
    lappend yDeriv [= {2*($h2*[@ $y end-2]-($h1+$h2)*[@ $y end-1]+$h1*[@ $y end])/($h1*$h2*($h1+$h2))}]
    return $yDeriv
}</pre></div>
</div><h3 class='ruffproc'><a name='::mathutil::findApprox'>findApprox</a><span class='ns_scope'> [<a href="index-mathutil.html#::mathutil" title="::mathutil" class='ruff_cmd'>::mathutil</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<p class='ruff'>Finds index of firts matched value in list with epsilon tolerance</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>findApprox</span> <span class='ruff_arg'>list value ?epsilon?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code>list</code></td><td>List of values.</td></tr>
<tr><td><code>value</code></td><td>Value to match.</td></tr>
<tr><td><code>epsilon</code></td><td>Tolerance. Optional, default <code>1</code>.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>value from the list</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_mathutil_findApprox' href="javascript:toggleSource('mathutil_findApprox')">Show source</a></p>
<div id='mathutil_findApprox' class='ruff_dyn_src'><pre>proc ::mathutil::findApprox {list value {epsilon 1}} {

    # Finds index of firts matched value in list with epsilon tolerance
    #  list - list of values
    #  value - value to match
    #  epsilon - tolerance
    # Returns: value from the list
    if {[string is double $epsilon]!=1} {
        error &quot;Epsilon must be a number&quot;
    } elseif {$epsilon&lt;=0} {
        error &quot;Epsilon must be larger than zero&quot;
    }
    if {[string is double $value]!=1} {
        error &quot;Value must be a number&quot;
    }
    set idx 0
    foreach x $list {
        if {abs($value - $x) &lt; $epsilon} {
            return $idx
        }
        incr idx
    }
    error &quot;Value '$value' was not found&quot;
}</pre></div>
</div><h3 class='ruffproc'><a name='::mathutil::movAvg'>movAvg</a><span class='ns_scope'> [<a href="index-mathutil.html#::mathutil" title="::mathutil" class='ruff_cmd'>::mathutil</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<p class='ruff'>Finds moving average of y with given window size.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>movAvg</span> <span class='ruff_arg'>y winSize ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code>y</code></td><td>List of values, must be larger than window size.</td></tr>
<tr><td><code>winSize</code></td><td>Size of the window, must be an integer larger than 1.</td></tr>
<tr><td><code>-x</code></td><td>Optional argument with x values.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>list of y, and x if -x argument is specified</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_mathutil_movAvg' href="javascript:toggleSource('mathutil_movAvg')">Show source</a></p>
<div id='mathutil_movAvg' class='ruff_dyn_src'><pre>proc ::mathutil::movAvg {y winSize args} {

    # Finds moving average of y with given window size.
    #  y - list of values, must be larger than window size
    #  winSize - size of the window, must be an integer larger than 1
    #  -x - optional argument with x values
    # Returns: list of y, and x if -x argument is specified
    set arguments [argparse {
        -x=
    }]
    # input verification
    if {[string is integer $winSize]!=1} {
        error &quot;Window size must be an integer&quot;
    } elseif {$winSize&lt;2} {
        error &quot;Window size must be larger than one&quot;
    } elseif {$winSize%2==0} {
        error &quot;Size of window must be odd&quot;
    }
    set yLen [llength $y]
    if {$yLen &lt; [+ $winSize 1]} {
        error &quot;Length of y '$yLen' must be not less than size of window + 1  '$winSize + 1 = [+ $winSize 1]'&quot;
    }
    if {[info exists x]} {
        set xLen [llength $x]
        if {$xLen != $yLen} {
            error &quot;Length of x '$xLen' is not equal to length of y '$yLen'&quot;
        }
    }
    # actual calculations
    set winSizeM1 [- $winSize 1]
    set halfWinSize [= {int($winSizeM1/2)}]
    for {set i $halfWinSize} {$i&lt;[- $yLen $halfWinSize]} {incr i} {
        set value 0
        for {set j [- $i $halfWinSize]} {$j&lt;=[+ $i $halfWinSize]} {incr j} {
            set value [= {$value+[@ $y $j]}]
        }
        lappend yAvg [= {$value/$winSize}]
    }
    if {[info exists x]} {
        return [list [lrange $x $halfWinSize end-$halfWinSize] $yAvg]
    } else {
        return $yAvg
    }
}</pre></div>
</div><h3 class='ruffproc'><a name='::mathutil::trapz'>trapz</a><span class='ns_scope'> [<a href="index-mathutil.html#::mathutil" title="::mathutil" class='ruff_cmd'>::mathutil</a>]</span><span class='ruff-uplink'><a href='#top'>Top</a>, <a href='index.html'>Main</a>, <a href='index-docindex.html#'>Index</a></span></h3>
<div style='clear:both;'></div>
<p class='ruff'>Does trapezoidal integration of x-y lists</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>trapz</span> <span class='ruff_arg'>x y</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td><code>x</code></td><td>List of x values.</td></tr>
<tr><td><code>y</code></td><td>List of y values.</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>value of integral</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_mathutil_trapz' href="javascript:toggleSource('mathutil_trapz')">Show source</a></p>
<div id='mathutil_trapz' class='ruff_dyn_src'><pre>proc ::mathutil::trapz {x y} {

    # Does trapezoidal integration of x-y lists
    #  x - list of x values
    #  y - list of y values
    # Returns: value of integral
    set xLen [llength $x]
    set yLen [llength $y]
    if {$xLen != $yLen} {
        error &quot;Length of x '$xLen' is not equal to length of y '$yLen'&quot;
    }
    set result 0.0
    for {set i 0} {$i&lt;[- $xLen 1]} {incr i} {
        set result [= {$result+([@ $y [+ $i 1]]+[@ $y $i])/2.0*([@ $x [+ $i 1]]-[@ $x $i])}]
    }
    return $result
}</pre></div>
</div></main><nav class='ruff-nav'><ul ><li class='ruff-toc1'><a style='padding-top:2px;' href='index.html'>Start page</a></li>
<li class='ruff-toc1'><a href='index-docindex.html' accesskey='i'>Index</a></li>
<hr>
<li class='ruff-toc1'><a href='index-gnuplotutil.html'>gnuplotutil</a></li>
<li class='ruff-toc1'><a class='ruff-highlight' href='index-mathutil.html'>mathutil</a></li>
<li class='ruff-toc1'><a href='index-rfutil.html'>rfutil</a></li>
<li class='ruff-toc1'><a href='index-touchstoneutil.html'>touchstoneutil</a></li>
<hr><li class='ruff-toc2'><a href='#::mathutil-Commands'>Commands</a></li><li class='ruff-toc3 ruff-tip'><a href='index-mathutil.html#::mathutil::cumtrapz'>cumtrapz</a><span class='ruff-tiptext'><pre><span class='ruff_cmd'>cumtrapz</span> <span class='ruff_arg'>x y ?init?</span></pre>Does trapezoidal integration with storing cumulative data at each point
</span></li><li class='ruff-toc3 ruff-tip'><a href='index-mathutil.html#::mathutil::deriv1'>deriv1</a><span class='ruff-tiptext'><pre><span class='ruff_cmd'>deriv1</span> <span class='ruff_arg'>x y</span></pre>Calculates first derivative of x-y lists
</span></li><li class='ruff-toc3 ruff-tip'><a href='index-mathutil.html#::mathutil::deriv2'>deriv2</a><span class='ruff-tiptext'><pre><span class='ruff_cmd'>deriv2</span> <span class='ruff_arg'>x y</span></pre>Calculates second derivative of x-y lists
</span></li><li class='ruff-toc3 ruff-tip'><a href='index-mathutil.html#::mathutil::findApprox'>findApprox</a><span class='ruff-tiptext'><pre><span class='ruff_cmd'>findApprox</span> <span class='ruff_arg'>list value ?epsilon?</span></pre>Finds index of firts matched value in list with epsilon tolerance
</span></li><li class='ruff-toc3 ruff-tip'><a href='index-mathutil.html#::mathutil::movAvg'>movAvg</a><span class='ruff-tiptext'><pre><span class='ruff_cmd'>movAvg</span> <span class='ruff_arg'>y winSize ?args?</span></pre>Finds moving average of y with given window size.
</span></li><li class='ruff-toc3 ruff-tip'><a href='index-mathutil.html#::mathutil::trapz'>trapz</a><span class='ruff-tiptext'><pre><span class='ruff_cmd'>trapz</span> <span class='ruff_arg'>x y</span></pre>Does trapezoidal integration of x-y lists
</span></li></ul></nav><footer class='ruff-layout-footer ruff-ft'><div style='float: right;'>Document generated by <a href='https://ruff.magicsplat.com'>Ruff!</a></div><div>&copy; George Yashin</div></footer>
</div></body></html>
